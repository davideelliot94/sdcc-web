<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Nuova prenotazioni</title>

	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="font-awesome/css/font-awesome.css" rel="stylesheet">

	<link href="css/plugins/iCheck/custom.css" rel="stylesheet">

	<link href="css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">

	<link href="css/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css"
		  rel="stylesheet">

	<link href="css/plugins/colorpicker/bootstrap-colorpicker.min.css"
		  rel="stylesheet">

	<link href="css/plugins/switchery/switchery.css" rel="stylesheet">

	<link href="css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">

	<link href="css/plugins/nouslider/jquery.nouislider.css"
		  rel="stylesheet">

	<link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">

	<link href="css/plugins/ionRangeSlider/ion.rangeSlider.css"
		  rel="stylesheet">
	<link href="css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css"
		  rel="stylesheet">

	<link
			href="css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
			rel="stylesheet">

	<link href="css/plugins/clockpicker/clockpicker.css" rel="stylesheet">

	<link href="css/plugins/daterangepicker/daterangepicker-bs3.css"
		  rel="stylesheet">

	<link href="css/plugins/select2/select2.min.css" rel="stylesheet">

	<link href="css/plugins/dualListbox/bootstrap-duallistbox.min.css"
		  rel="stylesheet">

	<link href="css/animate.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

</head>

<body>

<div id="wrapper">

	<nav class="navbar-default navbar-static-side" role="navigation">
		<div class="sidebar-collapse">
			<ul class="nav metismenu" id="side-menu">
				<li class="nav-header">
					<div class="dropdown profile-element">
							<span> <img alt="image" class="img-circle"
										src="img/default.png" id="profile_img"/>
							</span> <a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="clear"> <span class="block m-t-xs"> <strong
										class="font-bold"><script>sessionStorage.getItem('logged');</script></strong>
								</span> <span class="text-muted text-xs block">Prof <b
										class="caret"></b></span>
							</span>
					</a>
						<ul class="dropdown-menu animated fadeInRight m-t-xs">
							<li><a href="profile.html">Profile</a></li>
							<li><a href="mailbox.html">Notifiche</a></li>
							<li class="divider"></li>
							<li><a href="login.html">Logout</a></li>
						</ul>
					</div>
					<div class="logo-element">IN+</div>
				</li>
				<li><a href="dashboard_2.html"><i class="fa fa-th-large"></i>
					<span class="nav-label">Home page</span></a></li>
				<li><a href="mailbox.html"><i class="fa fa-envelope"></i>
					<span class="nav-label">Mailbox </span><span class="fa arrow"></span></a>
					<ul class="nav nav-second-level collapse">
						<li><a href="mailbox.html">Inbox</a></li>
						<li><a href="mail_compose.html">Compose email</a></li>
						<li id="joinlist"><a href="list_join.html">Join mailing list</a></li>
						<li id="createlist"><a href="new_list.html">Create mailing list</a></li>
					</ul></li>
				<li><a href="new_reservation.html"><i class="fa fa-edit"></i>
					<span class="nav-label">Nuova prenotazione</span></a></li>
				<li><a href="#"><i class="fa fa-table"></i> <span
						class="nav-label">Orari</span><span class="fa arrow"></span></a>
					<ul class="nav nav-second-level collapse">
						<li><a href="personal_hours.html">Orario personale</a></li>
						<li><a href="room_hours.html">Orario aula</a></li>
					</ul></li>
			</ul>

		</div>
	</nav>

	<div id="page-wrapper" class="gray-bg">
		<div class="row border-bottom">
			<nav class="navbar navbar-static-top" role="navigation"
				 style="margin-bottom: 0">
				<ul class="nav navbar-top-links navbar-right">

					<li><a href="mailbox.html"> <i class="fa fa-envelope"></i>Mailbox
					</a></li>

					<li><a href="login.html"> <i class="fa fa-sign-out"></i>
						Log out
					</a></li>
				</ul>

			</nav>
		</div>
		<div class="row wrapper border-bottom white-bg page-heading">
			<div class="col-lg-10">
				<h2>Nuova prenotazione</h2>
				<ol class="breadcrumb">
					<li><a href="index.html">Home</a></li>
					<li class="active"><a href="new_reservation.html"><strong>Nuova
						prenotazione</strong></a></li>
				</ol>
			</div>
			<div class="col-lg-2"></div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>
							Form nuova prenotazione <small>Compilare tutti i campi.</small>
						</h5>
						<div class="ibox-tools">
							<a class="close-link"> <i class="fa fa-times"></i>
							</a>
						</div>
					</div>

					<div class="ibox-content">
						<form method="get" class="form-horizontal" onsubmit="submitNewReservtion()" >
							<div class="hr-line-dashed"></div>
							<div class="form-group">
								<div class="col-sm-10">
									<p>Selezionare l'aula desiderata, all'interno
										dell'edificio scelto</p>
									<select id="selectRoom" class="select2_demo_2 form-control"
											multiple="multiple">

										
									</select>
								</div>
							</div>
							<div class="hr-line-dashed"></div>
							<div class="form-group">
								<div class="col-sm-10">
									<p>Scegliere la data</p>
									<div class="input-group date" id="datepicker" data-provide="datepicker" >
											<span class="input-group-addon"><i
													class="fa fa-calendar"></i></span>
													<input type="text" class="form-control" value="">	
									</div>
								</div>
							</div>
							<div class="hr-line-dashed"></div>
							<div class="form-group">
								<div class="col-sm-10">
									<p>
										Orario <small>Seleziona orario di inizio</small>
									</p>
									<select id="selectInterval" class="select2_demo_2 form-control">
										<option value="8:00-9:30">8:00-9:30</option>
										<option value="9:30-11:00">9:30-11:00</option>
										<option value="11:00-12:30">11:00-12:30</option>
										<option value="14:00-15:30">14:00-15:30</option>
										<option value="16:00-17:30">16:00-17:30</option>
										<option value="18:00-19:30">18:00-19:30</option>
									</select>
								</div>
							</div>
							<!--
							<div class="form-group">
								<div class="col-sm-10">
									<p>
										Orario <small>Seleziona orario di inizio</small>
									</p>
									<div class="input-group clockpicker" id="clockpickerStart"
										 data-autoclose="true">
										<input type="text" id="startClock" class="form-control" value="Select start of reservation">
										<span class="input-group-addon"> <span
												class="fa fa-clock-o"></span>
											</span>
									</div>

									<p>
										Orario <small>Seleziona l'orario di fine</small>
									</p>
									<div class="input-group clockpicker" id="clockpickerEnd"
										 data-autoclose="true">
										<input type="text" id="endClock" class="form-control" value="Select end of reservation">
										<span class="input-group-addon"> <span
												class="fa fa-clock-o"></span>
											</span>
									</div>

								</div>
							</div>
						-->
							<div class="hr-line-dashed"></div>
							<div class="form-group">
								<div class="col-sm-10">
									<p>
										Corso <small>Selezionare il corso della prenotazione</small>
									</p>
									<select id="selectCourse" class="select2_demo_2 form-control"
											multiple="multiple">
										<!--<option value="sdcc">sdcc</option>
										<option value="mobd">mobd</option>-->
									</select>
								</div>
							</div>
							<div class="hr-line-dashed"></div>

							<div class="form-group">
								<div class="col-sm-10">
									<p>
										Strumenti richiesti <small>Strumentazione richiesta</small>
									</p>
									<h3>Proiettore</h3>
									<input type="checkbox" id="checkProj" class="js-switch" checked />

									<h3>Microfono</h3>
									<input type="checkbox" id="checkMic" class="js-switch_2" checked />

									<!--<h3>Pi√∫ di 200 persone</h3>
									<input type="checkbox" class="js-switch_3" checked />-->
								</div>
							</div>

							<div class="hr-line-dashed"></div>
							<div class="row">
								<div class="form-group">
									<div class="col-sm-10 col-sm-offset-2">
										<button class="btn btn-white" type="submit">Annulla</button>
										<button class="btn btn-primary" type="submit">Prenota
											</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>

<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.js"></script>
<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Chosen -->
<script src="js/plugins/chosen/chosen.jquery.js"></script>

<!-- Input Mask-->
<script src="js/plugins/jasny/jasny-bootstrap.min.js"></script>

<!-- Data picker -->
<script src="js/plugins/datapicker/bootstrap-datepicker.js"></script>

<!-- Switchery -->
<script src="js/plugins/switchery/switchery.js"></script>

<!-- iCheck -->
<script src="js/plugins/iCheck/icheck.min.js"></script>

<!-- MENU -->
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>

<!-- Color picker -->
<script src="js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>

<!-- Clock picker -->
<script src="js/plugins/clockpicker/clockpicker.js"></script>

<!-- Date range use moment.js same as full calendar plugin -->
<script src="js/plugins/fullcalendar/moment.min.js"></script>

<!-- Select2 -->
<script src="js/plugins/select2/select2.full.min.js"></script>

<!-- Tags Input -->
<script src="js/plugins/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>

<!-- Dual Listbox -->
<script src="js/plugins/dualListbox/jquery.bootstrap-duallistbox.js"></script>

<script type="text/javascript" src="/controllers/reservationController.js"></script>

<script type="text/javascript" src="/controllers/logoutController.js"></script>
<script type="text/javascript" src="/controllers/profileController.js"></script>


<script>
	function doLogout(){
		logoutUser();

	}
</script>
<script>
		$("#datepicker").datepicker({ 
			daysOfWeekDisabled: '0,6',
			format: 'dd-mm-yyyy',
			startDate: '0',
			autoclose:true,
			locale: 'it-IT'
		 }) 

</script>

<script>
	function checkPermissions(){
		var role = parseInt(sessionStorage.getItem('role'));

		var log = sessionStorage.getItem('logged');
		if(log === null || log === undefined){
			window.location='/login.html';
			return false;
		}

		if(role === 1){
			document.getElementById("booking").style.display = "none";
			document.getElementById("createlist").style.display = "none";
			document.getElementById("roleP").innerHTML = "Student";

		}
		else{
			document.getElementById("joinlist").style.display = "none";
			document.getElementById("roleP").innerHTML = "Prof";

		}

	}
</script>

<!--
<script>
	function setEndClock() {
		var myInput = $('#clockpickerStart').clockpicker();
		var data = myInput.data();
		var h = data.clockpicker.hours;
		var m = data.clockpicker.minutes;
		myInput.change(function() {
			$('#clockpickerEnd').val("Il valore deve essere maggiore di: " + h+":"+m);
		});
	};
</script>
-->
<script>
	
	window.onload = async function loadRoomsandTeachings(){
		
		console.log("Load Called");

		

		var arr = await loadFunc();
		console.log(arr);
	
		var select = document.getElementById("selectRoom");
		for(index in arr.rooms) {
			
			select.options[select.options.length] = new Option(arr.rooms[index].name, index);
		};
		
		var select = document.getElementById("selectCourse");
		for(index in arr.teaching) {
			
			select.options[select.options.length] = new Option(arr.teaching[index].name, index);
		};

		var email = sessionStorage.getItem("userId");
		var result = await getUserImg(email);
		console.log(result);
		document.getElementById("profile_img").src = result;
		

		checkPermissions();
		
	};	
</script>
	
<script>
	function showDatePicker(){


		$('datepicker').datepicker({
			format: 'mm/dd/yyyy',
			startDate: '-3d'
		});


	}
	

</script>


<script>
	const API = (() => {
		var uri_postNewBooking = "";        //MODIFICARE PER AWS

	const postBooking = (id_student, postNameFunc) => () => {
		try {
			const val1 = document.querySelector(id_student).value; //da vedere!
			console.log("form values: " + JSON.stringify(val1));
			postNameFunc(val1);
		} catch (e) {
			console.log(e);
			console.log('--------------------------');
		}
		return false;// window.location.pathname = '/dashboard_2.html';
	};


	const makePostNameFunc = uri => (val1) => {
		console.log("makeGetBookingFunc; uri: " + JSON.stringify(uri));
		fetch(uri, {
			method: 'POST',
			body: JSON.stringify({
				value: val1,
			}),
			headers: {
				'Access-Control-Allow-Origin': '*',
				'Accept': 'application/json',
				'Content-Type': 'application/json'
			}
		}).then(function (response) {
			console.log('RES: ' + JSON.stringify(response));
		});
	};

	const post_newBookingFunc = makePostNameFunc(uri_postNewBooking);

	return {
		post_newBooking: postBooking("#id", post_newBookingFunc)
	}
	})();

</script>

<script>
	function  submitNewReservtion() {

		
		
		var roomSelector = document.getElementById("selectRoom");
		var courseSelector = document.getElementById("selectCourse");
		var int = document.getElementById("selectInterval").value;
		var checkMic = document.getElementById("checkMic");
		var checkProj = document.getElementById("checkProj");
		

		var date = $("#datepicker").datepicker('getDate');
		console.log(date);
		/*var clockTimeStart = $("#clockpickerStart").clockpicker();
		var cstart = clockTimeStart.data();
		var shour = cstart.clockpicker.hours;
		var sminutes = cstart.clockpicker.minutes;
		var startTime = [shour,sminutes];
		var clockTimeEnd = $("#clockpickerEnd").clockpicker();
		var cend = clockTimeEnd.data();
		var ehour = cend.clockpicker.hours;
		var eminutes = cend.clockpicker.minutes;
		var endTime = [ehour,eminutes];
		*/
		
		
		var room = roomSelector.options[roomSelector.selectedIndex].text;
		var course = courseSelector.options[courseSelector.selectedIndex].text;

		console.log(" room :"+room+",date :"+date+",course :"+course);
		
//         window.location.pathname = '/dashboard_2.html';

		var name = sessionStorage.getItem('logged');
		var jwtToken = sessionStorage.getItem(name);
		
		submitReservation(jwtToken,date,int,room,course,checkMic.checked,checkProj.checked);

		alert("Form submitted Successfully");
	}
</script>

<script>
	$(document).ready(function(){

		$('.tagsinput').tagsinput({
			tagClass: 'label label-primary'
		});

		$('#data_1 .input-group.date').datepicker({
			todayBtn: "linked",
			keyboardNavigation: false,
			forceParse: false,
			calendarWeeks: true,
			autoclose: true
		});

		$('#data_2 .input-group.date').datepicker({
			startView: 1,
			todayBtn: "linked",
			keyboardNavigation: false,
			forceParse: false,
			autoclose: true,
			format: "dd/mm/yyyy",
			
		});

		$('#data_3 .input-group.date').datepicker({
			startView: 2,
			todayBtn: "linked",
			keyboardNavigation: false,
			forceParse: false,
			autoclose: true
		});

		$('#data_4 .input-group.date').datepicker({
			minViewMode: 1,
			keyboardNavigation: false,
			forceParse: false,
			forceParse: false,
			autoclose: true,
			todayHighlight: true
		});

		$('#data_5 .input-daterange').datepicker({
			keyboardNavigation: false,
			forceParse: false,
			autoclose: true
		});

		var elem = document.querySelector('.js-switch');
		var switchery = new Switchery(elem, { color: '#1AB394' });

		var elem_2 = document.querySelector('.js-switch_2');
		var switchery_2 = new Switchery(elem_2, { color: '#ED5565' });

		//var elem_3 = document.querySelector('.js-switch_3');
		//var switchery_3 = new Switchery(elem_3, { color: '#1AB394' });

		$('.i-checks').iCheck({
			checkboxClass: 'icheckbox_square-green',
			radioClass: 'iradio_square-green'
		});


		$('.clockpicker').clockpicker();

		$('#reportrange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));


		$(".select2_demo_1").select2();
		$(".select2_demo_2").select2();
		$(".select2_demo_3").select2({
			placeholder: "Select a state",
			allowClear: true
		});

		$('.dual_select').bootstrapDualListbox({
			selectorMinimalHeight: 160
		});

		//query inoltro prenotazione



	});

	$('.chosen-select').chosen({width: "100%"});

</script>

</body>

</html>