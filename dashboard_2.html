<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>HOME |orario aule</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script>
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');
               // console.log('sParameter:  ' + sParameterName);
                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };
    </script>


</head>

<body onload="checkPermissions();">
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
							<span> <img alt="image" class="img-circle"
                                        src="img/cesati.jpg" />
							</span> <a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="clear"> <span class="block m-t-xs"> <strong
                                        class="font-bold"><script>
                                document.write(getUrlParameter('email'));
                            </script> </strong>
								</span> <span class="text-muted text-xs block">Prof <b
                                        class="caret"></b></span>
							</span>
                    </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Profile</a></li>
                            <li><a href="mailbox.html">Notifiche</a></li>
                            <li class="divider"></li>
                            <li><a onClick="doLogout(); return false;" href="login.html">Logout</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">IN+</div>
                </li>
                <li><a href="dashboard_2.html"><i class="fa fa-th-large"></i>
                    <span class="nav-label">Home page</span></a></li>
                <li><a href="mailbox.html"><i class="fa fa-envelope"></i>
                    <span class="nav-label">Mailbox </span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="mailbox.html">Inbox</a></li>
                        <li><a href="mail_detail.html">Email view</a></li>
                        <li><a href="mail_compose.html">Compose email</a></li>
                    </ul></li>
                <li id="booking"><a href="new_reservation.html"><i class="fa fa-edit"></i>
                    <span class="nav-label">Nuova prenotazione</span></a></li>
                <li><a href="#"><i class="fa fa-table"></i> <span
                        class="nav-label">Orari</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="personal_hours.html">Orario personale</a></li>
                        <li><a href="room_hours.html">Orario aula</a></li>
                    </ul></li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top white-bg" role="navigation"
                 style="margin-bottom: 0">
                <ul class="nav navbar-top-links navbar-right">

                    <li><a href="mailbox.html"> <i class="fa fa-envelope"></i>Mailbox
                    </a></li>

                    <li><a onClick="doLogout(); return false;" href="login.html"> <i class="fa fa-sign-out"></i>
                        Log out
                    </a></li>
                </ul>

            </nav>
        </div>
        <div class="wrapper wrapper-content">
            <div class="row">
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Utenti registrati</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 id ="regUserVal" class="no-margins">1</h1>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Totale professori</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 id="totTeacherVal" class="no-margins"></h1>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Totale studenti</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 id="totStudVal" class="no-margins"></h1>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Utenti attivi</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 id="actUserVal" class="no-margins">0,0</h1>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Messages</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link"> <i class="fa fa-chevron-up"></i>
                                </a> <a class="close-link"> <i class="fa fa-times"></i>
                            </a>
                            </div>
                        </div>
                        <div class="ibox-content ibox-heading">
                            <h3>
                                <i class="fa fa-envelope-o"></i> New messages
                            </h3>
                        </div>
                        <div class="ibox-content">
                            <div id="notificationList" class="feed-activity-list">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>User project list</h5>
                                    <div class="ibox-tools">
                                        <a class="collapse-link"> <i class="fa fa-chevron-up"></i>
                                        </a> <a class="close-link"> <i class="fa fa-times"></i>
                                    </a>
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    <table id="todayHourTable" class="table table-hover no-margins">

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mainly scripts -->
            <script src="js/jquery-3.1.1.min.js"></script>
            <script src="js/bootstrap.min.js"></script>
            <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
            <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

            <!-- Flot -->
            <script src="js/plugins/flot/jquery.flot.js"></script>
            <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
            <script src="js/plugins/flot/jquery.flot.spline.js"></script>
            <script src="js/plugins/flot/jquery.flot.resize.js"></script>
            <script src="js/plugins/flot/jquery.flot.pie.js"></script>
            <script src="js/plugins/flot/jquery.flot.symbol.js"></script>
            <script src="js/plugins/flot/jquery.flot.time.js"></script>

            <!-- Peity -->
            <script src="js/plugins/peity/jquery.peity.min.js"></script>
            <script src="js/demo/peity-demo.js"></script>

            <!-- Custom and plugin javascript -->
            <script src="js/inspinia.js"></script>
            <script src="js/plugins/pace/pace.min.js"></script>

            <!-- jQuery UI -->
            <script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

            <!-- Jvectormap -->
            <script src="js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
            <script
                    src="js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

            <!-- EayPIE -->
            <script src="js/plugins/easypiechart/jquery.easypiechart.js"></script>

            <!-- Sparkline -->
            <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

            <!-- Sparkline demo data  -->
            <script src="js/demo/sparkline-demo.js"></script>

            <script type="text/javascript" src="/controllers/dashboardController.js"></script>


            <script>
                function checkPermissions(){
                    var role = sessionStorage.getItem('role');

                    var log = sessionStorage.getItem('logged');
                    if(log === null || log === undefined){
                        window.location='/login.html';
                        return false;
                    }


                    if(role == 0){
                        document.getElementById("booking").style.display = "none";

                    }
                    var totalTeachers;
                    getTotalTeachers().then(function(res){
                        console.log('got res: ' + res);
                        document.getElementById("totTeacherVal").innerHTML = res;
                        totalTeachers = res;
                        //sessionStorage.setItem('teachers',res);
                    });
                    getNumberUsers().then(function(res){
                        console.log('got res: ' + res);
                        document.getElementById("regUserVal").innerHTML = res;
                        document.getElementById("totStudVal").innerHTML = JSON.stringify(res - totalTeachers);
                        //sessionStorage.setItem('users',res);
                    });


                }
            </script>

            <script>
                function doLogout(){
                    console.log('doing logout');
                    sessionStorage.removeItem('logged');
                    sessionStorage.removeItem('email');
                    sessionStorage.removeItem('name');
                    sessionStorage.removeItem('surname');
                    sessionStorage.removeItem('role');
                    window.location='/login.html';

                }
            </script>


            <script>
                $(document).ready(function() {

                    $("#actUserVal").html(activeUser);

                    var head = ["Ora","Corso","Aula"];
                    var hours = ["8.15-9.15","9.30-11.00","11.30-13.00","14.00-15.30","16.00-17.30","18.00-19.30"];
                    var totalBooking = [[["sdcc "],["A1 "]],
                        [[" "],[" "]],
                        [[" Mobd"],["D1 "]],
                        [[" "],[" "]],
                        [[" "],[" "]],
                        [[" "],[" "]]];

                    var tableString = '';
                    tableString += ('<thead><tr>');
                    $.each(head, function(indexHead, headI) {
                        tableString += ('<th>'+headI+'</th>')
                    });
                    tableString +=('</tr></thead>');
                    tableString += ('<tbody>');

                    $.each(hours, function(indexHour, hour) {
                        tableString += ('<tr><td><i class="fa fa-clock-o"></i>'+' '+hour+'</td>');
                        $.each(totalBooking[indexHour], function(indexDayBooking, bookingPerDay){ //totalBooking = [[pren.lun],[pren.mart],[pren.merc],...]
                            tableString += ('<td>'+bookingPerDay+'</td>');
                        });
                        tableString += ('</tr>');
                    });
                    tableString += ('</tbody>');
                    $("#todayHourTable").html(tableString);

                    var notificationString = '';
                    var totalNotification = [["5m ago","stefano","tanto va la gatta al lardo...","Yesterday 8:48 pm - 10.06.2014"]];

                    $.each(totalNotification, function(indexNotification, notification) {
                        notificationString += ('<div class="feed-element"><div>');
                        notificationString += ('<small class="pull-right">'+notification[0]+'</small>');
                        notificationString += ('<strong>'+notification[1]+'</strong>');
                        notificationString += ('<div>'+notification[2]+'</div>');
                        notificationString += ('<small class="text-muted">'+notification[3]+'</small></div>');
                        notificationString += ('</div>');
                    });
                    $("#notificationList").html(notificationString);
                });
            </script>
</body>
</html>
